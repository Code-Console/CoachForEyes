<script type="text/javascript" src="data:text/javascript;base64,dmFyIGNvdW50ZXIgPSAwLCBpc1Jlc2l6ZSA9IDAsIGlzUmVzaXplID0gMDsKdmFyIHNjZW5lLCBjYW1lcmEsIHJlbmRlcmVyLCBnYW1lVUksIG1UdWJlID0gW107CnZhciBDQU5WQVNfV0lEVEggPSA0ODAsIENBTlZBU19IRUlHSFQgPSA4NTQ7CnZhciBtUGxheWVyLG1QdXNoLG1Qb3A7CnZhciBtVGV4X2ZvbnRzID0gQXJyYXkoMik7CnZhciBtR2FtZVdhdGVycyA9IFtdOwp2YXIgcmF5Y2FzdGVyID0gbmV3IFRIUkVFLlJheWNhc3RlcigpOwp2YXIgbUFuaW07Cgp2YXIgaGFuZFZpc2libGUgPSB0cnVlOwpmdW5jdGlvbiBpbml0KCkgewogICAgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDQ1LCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMC4xLCAxMDAwKTsKICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgMCwgMzAwKTsgY2FtZXJhLnJvdGF0aW9uLnNldCgwLCAwLCAwKTsKICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgNDAsIDI1MCk7IGNhbWVyYS5yb3RhdGlvbi5zZXQoLS40LCAwLCAwKTsKICAgIHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7IHNjZW5lLmJhY2tncm91bmQgPSBuZXcgVEhSRUUuQ29sb3IoMHgwMDAwMDApOwogICAgdmFyIG1hbmFnZXIgPSBuZXcgVEhSRUUuTG9hZGluZ01hbmFnZXIobG9hZE1vZGVsKTsKICAgIG1hbmFnZXIub25Qcm9ncmVzcyA9IGZ1bmN0aW9uIChpdGVtLCBsb2FkZWQsIHRvdGFsKSB7IH07CiAgICBmdW5jdGlvbiBvblByb2dyZXNzKHhocikgeyBpZiAoeGhyLmxlbmd0aENvbXB1dGFibGUpIHsgfSB9CiAgICBmdW5jdGlvbiBvbkVycm9yKCkgeyB9CiAgICBzY2VuZS5hZGQobmV3IFRIUkVFLkFtYmllbnRMaWdodCgweGZmZmZmZiwgMC42KSk7CiAgICBkaXJlY3Rpb25hbExpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuNik7CiAgICBkaXJlY3Rpb25hbExpZ2h0LnBvc2l0aW9uLnNldCgzLCAtMiwgMik7CiAgICBzY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodCk7CiAgICBtUGxheWVyPSBuZXcgUGxheWVyKCk7CiAgICBtUHVzaCA9IG5ldyBQdXNoUG9wKCk7CiAgICBtUG9wID0gbmV3IFB1c2hQb3AoKTsKICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDIwMCwgNDAwKTsKICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IG1hcDogbG9hZFRleHR1cmUoQkdfNjQpIH0pOwogICAgbVBsYW5fSG9tZSA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICBtUGxhbl9Ib21lLnBvc2l0aW9uLnNldCgwLCAtMTIwLCAtMTAwKTsKICAgIG1QbGFuX0hvbWUucm90YXRpb24uc2V0KC0uNCwgMCwgMCk7CiAgICBzY2VuZS5hZGQobVBsYW5fSG9tZSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIG1UdWJlLnB1c2gobmV3IFR1YmUoKSk7CiAgICAgICAgbVR1YmVbaV0uZ3JvdXAucG9zaXRpb24uc2V0KGkgKiAxNSwgMCwgMCk7CiAgICAgICAgbVR1YmVbaV0uY2lyY2xlLm5hbWUgPSAieW9nZXNoIiArIGk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE1OyBpKyspIHsKICAgICAgICBtR2FtZVdhdGVycy5wdXNoKG5ldyBXYXRlcigxKSk7CiAgICB9CiAgICBtRmxvdyA9IG5ldyBGbG93KCk7CiAgICBtQW5pbSA9IG5ldyBBbmltYXRpb24oKTsKICAgIHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoeyBhbnRpYWxpYXM6IHRydWUgfSk7CiAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOwogICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpOwogICAgZ2FtZVVJID0gbmV3IFRocmVlVUkocmVuZGVyZXIuZG9tRWxlbWVudCwgNzIwKTsKICAgIEFzc2V0TG9hZGVyLmFkZC5pbWFnZTY0KCdDT05UXzY0JywgQ09OVF82NCk7CiAgICBBc3NldExvYWRlci5hZGQuaW1hZ2U2NCgnSEFORF82NCcsIEhBTkRfNjQpOwogICAgQXNzZXRMb2FkZXIuYWRkLmltYWdlNjQoJ1RFWFRfNjQnLCBURVhUXzY0KTsKICAgIEFzc2V0TG9hZGVyLmFkZC5pbWFnZTY0KCdETE9BRF82NCcsIERMT0FEXzY0KTsKICAgIEFzc2V0TG9hZGVyLnByb2dyZXNzTGlzdGVuZXIgPSBmdW5jdGlvbiAocHJvZ3Jlc3MpIHsgfTsKICAgIEFzc2V0TG9hZGVyLmxvYWQoZnVuY3Rpb24gKCkgewogICAgICAgIG1UZXhfaGFuZCA9IGxvYWRVSSgnSEFORF82NCcsIDAsIDIwMCwgMCk7CiAgICAgICAgbVRleF9oYW5kLnZpc2libGUgPSB0cnVlOwogICAgICAgIG1UZXhfaGFuZC52eCA9IC0xOwogICAgICAgIG1UZXhfQ29udGludWUgPSBsb2FkVUkoJ0NPTlRfNjQnLCAwLCAyMDAsIDExKTsKICAgICAgICBtVGV4X0NvbnRpbnVlLnZ4ID0gMS4wMTsKICAgICAgICBtVGV4X0NvbnRpbnVlLnN4ID0gMTsKCiAgICAgICAgbVRleF9Eb3dubG9hZCA9IGxvYWRVSSgnRExPQURfNjQnLCAwLCAtMzIwLCAxMik7CiAgICAgICAgbVRleF9Eb3dubG9hZC52eCA9IDEuMTsKICAgICAgICBtVGV4X0Rvd25sb2FkLnMgPSAxOwogICAgICAgIG1UZXhfRG93bmxvYWQuc3ggPSAxLjE7CiAgICAgICAgbVRleF9Eb3dubG9hZC5jb3VudCA9IDA7CiAgICAgICAgRHJhd1RleHR1cmUobVRleF9Eb3dubG9hZCwgMCwgLTMyMCwyMDAsNTApOwoKICAgICAgICBtVGV4X3RleHQgPSBsb2FkVUkoJ1RFWFRfNjQnLCAwLCAtMjAwLCAwKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1UZXhfZm9udHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbVRleF9mb250c1tpXSA9IGNyZWF0ZVRleHRzKCIxMDAiLCAyMCwgIiNmZmYiLCBUaHJlZVVJLmFuY2hvcnMuY2VudGVyLCBUaHJlZVVJLmFuY2hvcnMuY2VudGVyLCAiY2VudGVyIiwgIkhhbmFsZWlGaWxsIik7CiAgICAgICAgfQogICAgICAgIHNldFNjcmVlbigpOwogICAgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZSA9PiB7IHRvdWNoRXZlbnQoZSwgMCwgMSk7IH0pOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZSA9PiB7IHRvdWNoRXZlbnQoZSwgMSwgMSk7IH0pOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBlID0+IHsgdG91Y2hFdmVudChlLCAyLCAxKTsgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBlID0+IHsgdG91Y2hFdmVudChlLCAwLCAwKTsgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBlID0+IHsgdG91Y2hFdmVudChlLCAxLCAwKTsgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZSA9PiB7IHRvdWNoRXZlbnQoZSwgMiwgMCk7IH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplLCBmYWxzZSk7CiAgICBEcmF3KCk7Cn0KY29uc3QgQ1NQRCA9IDEuNTsKZnVuY3Rpb24gb25XaW5kb3dSZXNpemUoKSB7CiAgICBjYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgICBjYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKICAgIHRoaXMuZ2FtZVVJLnJlc2l6ZSgpOwogICAgaXNSZXNpemUgPSA1Owp9CnZhciBtb3VzZSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7CnZhciBjb29yZHMgPSBudWxsOwp2YXIgdmVjMiA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7CnZhciBpc0NsaWNrID0gZmFsc2U7CnZhciByYXRpb24gPSAxOwpmdW5jdGlvbiB0b3VjaEV2ZW50KGUsIHR5cGUsIHN5cykgewogICAgQ0FOVkFTX1dJRFRIID0gd2luZG93LmlubmVyV2lkdGg7CiAgICBDQU5WQVNfSEVJR0hUID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgcmF0aW9uID0gQ0FOVkFTX1dJRFRIIC8gQ0FOVkFTX0hFSUdIVDsKICAgIGlmIChlLnRvdWNoZXMgIT0gbnVsbCkgewogICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBtb3VzZS54ID0gKGUudG91Y2hlc1swXS5wYWdlWCAvIHdpbmRvdy5pbm5lcldpZHRoKSAqIDIgLSAxOwogICAgICAgICAgICBtb3VzZS55ID0gLShlLnRvdWNoZXNbMF0ucGFnZVkgLyB3aW5kb3cuaW5uZXJIZWlnaHQpICogMiArIDE7CiAgICAgICAgICAgIGNvb3JkcyA9IHsgeDogZS50b3VjaGVzWzBdLnBhZ2VYLCB5OiBlLnRvdWNoZXNbMF0ucGFnZVkgfTsKICAgICAgICAgICAgY29vcmRzLnggPSBjb29yZHMueCAtICh3aW5kb3cuaW5uZXJXaWR0aCAtIGdhbWVVSS5nYW1lQ2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSAvIDI7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBtb3VzZS54ID0gKGUuY2xpZW50WCAvIHdpbmRvdy5pbm5lcldpZHRoKSAqIDIgLSAxOwogICAgICAgIG1vdXNlLnkgPSAtKGUuY2xpZW50WSAvIHdpbmRvdy5pbm5lckhlaWdodCkgKiAyICsgMTsKICAgICAgICBjb29yZHMgPSB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07CiAgICAgICAgY29vcmRzLnggPSBjb29yZHMueCAtICh3aW5kb3cuaW5uZXJXaWR0aCAtIGdhbWVVSS5nYW1lQ2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSAvIDI7CiAgICAgICAgdmFyIGVsZW0gPSByZW5kZXJlci5kb21FbGVtZW50LCBib3VuZGluZ1JlY3QgPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLAogICAgICAgICAgICB4ID0gKGV2ZW50LmNsaWVudFggLSBib3VuZGluZ1JlY3QubGVmdCkgKiAoZWxlbS53aWR0aCAvIGJvdW5kaW5nUmVjdC53aWR0aCksCiAgICAgICAgICAgIHkgPSAoZXZlbnQuY2xpZW50WSAtIGJvdW5kaW5nUmVjdC50b3ApICogKGVsZW0uaGVpZ2h0IC8gYm91bmRpbmdSZWN0LmhlaWdodCk7CiAgICAgICAgbW91c2UueCA9ICh4IC8gQ0FOVkFTX1dJRFRIKSAqIDIgLSAxOwogICAgICAgIG1vdXNlLnkgPSAtKHkgLyBDQU5WQVNfSEVJR0hUKSAqIDIgKyAxOwoKICAgIH0KICAgIHJheWNhc3Rlci5zZXRGcm9tQ2FtZXJhKG1vdXNlLCBjYW1lcmEpOwogICAgaWYgKHR5cGUgPT0gMiAmJiBtb3VzZS55ID4gLjggJiYgbVBsYXllci5nT3ZlciA9PSBmYWxzZSkgewogICAgICAgIGdhbWVyZXNldCgpOwogICAgfQogICAgaWYgKG1vdXNlLnkgPCAuNSkKICAgICAgICBIYW5kbGVfR2FtZSh0eXBlKTsKCn0KZnVuY3Rpb24gRHJhdygpIHsKICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShEcmF3KTsKICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKTsKICAgIGdhbWVVSS5yZW5kZXIocmVuZGVyZXIpOwogICAgaWYgKG1UZXhfQ29udGludWUgPT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAobVBsYXllci5nT3ZlciA9PSBmYWxzZSkgewogICAgICAgIGRyYXdHYW1lKCk7CiAgICB9IGVsc2UgewogICAgICAgIERyYXdUZXh0dXJlKG1UZXhfQ29udGludWUsIDAsIDIwMCxtVGV4X0NvbnRpbnVlLnN4ICogMjU2LCBtVGV4X0NvbnRpbnVlLnN4ICogNjQpOwogICAgICAgIGlmIChtVGV4X0NvbnRpbnVlLnN4ID4gMS4xKSB7CiAgICAgICAgICAgIG1UZXhfQ29udGludWUudnggPSAuOTk1OwogICAgICAgIH0KICAgICAgICBpZiAobVRleF9Db250aW51ZS5zeCA8IDAuOTkpIHsKICAgICAgICAgICAgbVRleF9Db250aW51ZS52eCA9IDEuMDA1OwogICAgICAgIH0KICAgICAgICBtVGV4X0NvbnRpbnVlLnN4ICo9IG1UZXhfQ29udGludWUudng7CiAgICB9CiAgICBpbnN0YWxsQW5pbWF0aW9uKCk7CiAgICBpZiAobUFuaW0uZ3JvdXAudmlzaWJsZSkKICAgICAgICBtQW5pbS51cGRhdGUoKTsKICAgIGlmIChtQW5pbS5ncm91cDIudmlzaWJsZSkgewogICAgICAgIG1BbmltLnRVcGRhdGUoKTsKICAgICAgICBpZiAobVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi55ID4gbVR1YmVbbVB1c2gudHViZU5vXS5heSArIDcpIHsKICAgICAgICAgICAgbUFuaW0uZ3JvdXAyLnR2eSA9IDEuMDE1OwogICAgICAgICAgICBpZiAobUFuaW0uZ3JvdXAyLnRjb3VudCA+IDEpCiAgICAgICAgICAgICAgICBtQW5pbS5ncm91cDIudHZ5ID0gMS4wMTsKICAgICAgICB9CiAgICAgICAgLy9mb3IgdHViIGZpbGwgYW5pbWF0aW9uCiAgICAgICAgaWYgKG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSA8IG1UdWJlW21QdXNoLnR1YmVOb10uYXkpIHsKICAgICAgICAgICAgbUFuaW0uZ3JvdXAyLnRjb3VudCsrOwogICAgICAgICAgICBtQW5pbS5ncm91cDIudHZ5ID0gMC45ODU7CiAgICAgICAgICAgIGlmIChtQW5pbS5ncm91cDIudGNvdW50ID4gMSkKICAgICAgICAgICAgICAgIG1BbmltLmdyb3VwMi50dnkgPSAwLjk5OwogICAgICAgIH0KICAgICAgICBtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnkgKj0gbUFuaW0uZ3JvdXAyLnR2eTsKICAgICAgICBpZiAobUFuaW0uZ3JvdXAyLnRjb3VudCA+IDIpCiAgICAgICAgICAgIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSA9IG1UdWJlW21QdXNoLnR1YmVOb10uYXk7CiAgICB9CiAgICBjb3VudGVyKys7CiAgICBpZiAoaXNSZXNpemUgPiAwKSB7CiAgICAgICAgY2FtZXJhLmFzcGVjdCA9IHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKICAgICAgICB0aGlzLmdhbWVVSS5yZXNpemUoKTsKICAgICAgICBpc1Jlc2l6ZS0tOwogICAgfQp9CmZ1bmN0aW9uIGRyYXdHYW1lKCkgewogICAgaWYgKG1QbGF5ZXIuYW5pbSA9PSAwKSB7CiAgICAgICAgaWYgKChtUGxheWVyLnZ4IDwgMCAmJiBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCA+IDAgKyBtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggLSAxNSkgfHwKICAgICAgICAgICAgKG1QbGF5ZXIudnggPiAwICYmIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IDwgMCArIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCAtIDE1KSkgewogICAgICAgICAgICBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCArPSBtUGxheWVyLnZ4OwogICAgICAgIH0KICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnkgPCBtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnkgKyAxOCkgewogICAgICAgICAgICBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSArPSAxOwogICAgICAgIH0gZWxzZSBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnJvdGF0aW9uLnogPiAtMS4yKSB7CiAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5yb3RhdGlvbi56IC09IC4yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi54ID0gbVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IC0gMTU7CiAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi56ID0gbVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi56OwogICAgICAgICAgICBtRmxvdy5ncm91cC5wb3NpdGlvbi5zZXQobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggKyA5LCBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSArIC0yLjUsIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi56KTsKICAgICAgICAgICAgaWYgKG1GbG93LmdjeWwxLnNjYWxlLnkgPiAtNC4yKSB7CiAgICAgICAgICAgICAgICBtRmxvdy5nY3lsMS5zY2FsZS55IC09IC4zOwogICAgICAgICAgICAgICAgbUZsb3cuZ2N5bDEudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAobUZsb3cuZ2N5bDEuc2NhbGUueSA8IC00LjIpIHsKICAgICAgICAgICAgICAgICAgICBtRmxvdy5nY3lsMS5zY2FsZS55ID0gLTQuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChtRmxvdy5jeWwyLnZpc2libGUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIG1GbG93LmN5bDIudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobUZsb3cuZ2N5bDMuc2NhbGUueSA8IDUpIHsKICAgICAgICAgICAgICAgIG1GbG93LmdjeWwzLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgbUZsb3cuZ2N5bDMuc2NhbGUueSArPSAuMzsKICAgICAgICAgICAgICAgIGNoZWNrQWxsRmlsbCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdHViZUVtcHR5KG1Qb3AudHViZU5vLCBtUHVzaC50dWJlTm8sIG1Qb3Aud05vLCBtUHVzaC53Tm8gKyAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW21Qb3Aud05vXS5ncm91cC52aXNpYmxlID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBjaGVja1R1YmVGaWxsKCk7CiAgICAgICAgICAgICAgICBpZiAobVBvcC53Tm8gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgbVBvcC53Tm8tLTsKICAgICAgICAgICAgICAgICAgICBtUHVzaC53Tm8rKzsKICAgICAgICAgICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW21Qb3Aud05vXS5jb2xvciA9PSBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW21QdXNoLndOb10uY29sb3IgJiYgbVB1c2gud05vICsgMSA8IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXIubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXJbbVB1c2gud05vICsgMV0uc2V0Q29sb3IobVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW21Qb3Aud05vXS5jb2xvcik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbUZsb3cucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbVBsYXllci5hbmltID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1GbG93LnJlc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgbVR1YmVbbVBvcC50dWJlTm9dLmJhc2UudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIG1QbGF5ZXIuYW5pbSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBpZiAobVBsYXllci5hbmltID09IDEpIHsKICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnJvdGF0aW9uLnogPCAwKSB7CiAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5yb3RhdGlvbi56ICs9IC4yOwogICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnJvdGF0aW9uLnogPiAwKSB7CiAgICAgICAgICAgICAgICBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucm90YXRpb24ueiA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi54ICE9IG1UdWJlW21Qb3AudHViZU5vXS5heCkgewogICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggPiBtVHViZVttUG9wLnR1YmVOb10uYXgpIHsKICAgICAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IC09IG1QbGF5ZXIudng7CiAgICAgICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggPCBtVHViZVttUG9wLnR1YmVOb10uYXgpIHsKICAgICAgICAgICAgICAgICAgICBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCA9IG1UdWJlW21Qb3AudHViZU5vXS5heDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggPCBtVHViZVttUG9wLnR1YmVOb10uYXgpIHsKICAgICAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IC09IG1QbGF5ZXIudng7CiAgICAgICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggPiBtVHViZVttUG9wLnR1YmVOb10uYXgpIHsKICAgICAgICAgICAgICAgICAgICBtVHViZVttUG9wLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCA9IG1UdWJlW21Qb3AudHViZU5vXS5heDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnkgPiBtVHViZVttUG9wLnR1YmVOb10uYXkpIHsKICAgICAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi55IC09IC45OwogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1QbGF5ZXIuYW5pbSA9IDI7CiAgICAgICAgICAgIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi5zZXQobVR1YmVbbVBvcC50dWJlTm9dLmF4LCBtVHViZVttUG9wLnR1YmVOb10uYXksIG1UdWJlW21Qb3AudHViZU5vXS5heik7CiAgICAgICAgICAgIGNoZWNrR2FtZU92ZXIoKTsKICAgICAgICB9CiAgICB9CiAgICBpZiAobVRleF9oYW5kLnZpc2libGUgPT0gdHJ1ZSkgewogICAgICAgIERyYXdUZXh0dXJlKG1UZXhfaGFuZCwgbVRleF9oYW5kLngsIC0wLDY0LDY0KTsKICAgICAgICBEcmF3VGV4dHVyZShtVGV4X3RleHQsMCwtMTYwLCAyNTYsIDQ3KTsKICAgICAgICBpZiAobVRleF9oYW5kLnggPCAtNTApIHsKICAgICAgICAgICAgbVRleF9oYW5kLnZ4ID0gMDsKICAgICAgICAgICAgbVRleF9oYW5kLnggLT0gLjE7CiAgICAgICAgICAgIGlmIChtVGV4X2hhbmQuYWxwaGEgPiAuMSkgewogICAgICAgICAgICAgICAgbVRleF9oYW5kLmFscGhhIC09IC4wNzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1UZXhfaGFuZC54ID0gNjA7CiAgICAgICAgICAgICAgICBtVGV4X2hhbmQuYWxwaGEgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vCiAgICAgICAgfQogICAgICAgIGlmIChtVGV4X2hhbmQueCA+IDU1KSB7CiAgICAgICAgICAgIG1UZXhfaGFuZC52eCA9IC0xOwogICAgICAgICAgICAvLyBtVGV4X2hhbmQuYWxwaGEgPSAuNTsKICAgICAgICB9CiAgICAgICAgbVRleF9oYW5kLnggKz0gbVRleF9oYW5kLnZ4OwogICAgICAgIG1UZXhfdGV4dC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAvLyBEcmF3TGJsKG1UZXhfZm9udHNbMV0sICJUYXAgdGhlIFR1YmVzIHRvIFN0YXJ0IiwgMCwgLTEwMiwgIiNmZmZmZmYiLCAzMCk7CiAgICAgICAgLy8gRHJhd0xibChtVGV4X2ZvbnRzWzBdLCAiVGFwIHRoZSBUdWJlcyB0byBTdGFydCIsIDIsIC0xMDAsICIjMDAwMDAwIiwgMzApOwogICAgICAgIC8vIG1UZXhfaGFuZC5hbHBoYSA9ICgxMTEgLSAobVRleF9oYW5kLnggKyA0MCkpICogLjAxOwoKICAgIH0KfQoKZnVuY3Rpb24gaW5zdGFsbEFuaW1hdGlvbigpewogIGlmKGNvdW50ZXIgJSAzMDAgPCAzNTApewogICAgRHJhd1RleHR1cmUobVRleF9Eb3dubG9hZCwwLCAtMzIwLDIwMCptVGV4X0Rvd25sb2FkLnMsNTAqbVRleF9Eb3dubG9hZC5zKTsKICAgIG1UZXhfRG93bmxvYWQueCArPSBtVGV4X0Rvd25sb2FkLnZ4OwogICAgaWYobVRleF9Eb3dubG9hZC54PjUpCiAgICAgIG1UZXhfRG93bmxvYWQudnggPSAtMjsKICAgIGlmKG1UZXhfRG93bmxvYWQueDwtNSkKICAgICAgbVRleF9Eb3dubG9hZC52eCA9IDI7CgogICAgICBtVGV4X0Rvd25sb2FkLnMgKj0gbVRleF9Eb3dubG9hZC5zeDsKICAgICAgaWYobVRleF9Eb3dubG9hZC5zPjAuOSkKICAgICAgICBtVGV4X0Rvd25sb2FkLnN4ID0gLjk5OwogICAgICBpZihtVGV4X0Rvd25sb2FkLnM8LjgpCiAgICAgICAgbVRleF9Eb3dubG9hZC5zeCA9IDEuMDE7CiAgICBtVGV4X0Rvd25sb2FkLmNvdW50Kys7CiAgfWVsc2V7CiAgICBEcmF3VGV4dHVyZShtVGV4X0Rvd25sb2FkLDAsIC0zMjAsMjAwKm1UZXhfRG93bmxvYWQucyw1MCptVGV4X0Rvd25sb2FkLnMpOwogIH0KfQoKZnVuY3Rpb24gY2hlY2tHYW1lT3ZlcigpIHsKICAgIG1QbGF5ZXIuZ092ZXIgPSB0cnVlOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtVHViZS5sZW5ndGggJiYgbVBsYXllci5nT3ZlciA9PSB0cnVlOyBpKyspIHsKICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtVHViZVtpXS53YXRlci5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAobVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAudmlzaWJsZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBrKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGsgIT0gMCAmJiBrICE9IG1UdWJlW2ldLndhdGVyLmxlbmd0aCkgewogICAgICAgICAgICBtUGxheWVyLmdPdmVyID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgbVRleF9Db250aW51ZS52aXNpYmxlID0gbVBsYXllci5nT3ZlcjsKICAgIC8vIG1BbmltLnJlc2V0QWxsKG1QbGF5ZXIuZ092ZXIpOwogICAgaWYgKG1QbGF5ZXIubHZsID09IDQgJiYgbVBsYXllci5nT3ZlcikgewogICAgICAgIERyYXdMYmwobVRleF9mb250c1sxXSwgIldhdGVyIFNvcnQgM2QiLCAwLCAtMjAyLCAiI2ZmZmZmZiIsIDMwKTsKICAgICAgICBEcmF3TGJsKG1UZXhfZm9udHNbMF0sICJXYXRlciBTb3J0IDNkIiwgMiwgLTIwMCwgIiMwMDAwMDAiLCAzMCk7CiAgICB9Cn0KZnVuY3Rpb24gY2hlY2tBbGxGaWxsKCkgewogICAgbUFuaW0uZ3JvdXAudmlzaWJsZSA9IHRydWU7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1UdWJlLmxlbmd0aCAmJiBtQW5pbS5ncm91cC52aXNpYmxlOyBpKyspIHsKICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtVHViZVtpXS53YXRlci5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAobVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAudmlzaWJsZSA9PSB0cnVlICYmICEobVBvcC50dWJlTm8gPT0gaSAmJiBtUG9wLndObyA9PSBqKSkgewogICAgICAgICAgICAgICAgaysrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtUHVzaC50dWJlTm8gPT0gaSAmJiBtUHVzaC53Tm8gPT0gaikgewogICAgICAgICAgICAgICAgaysrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChrICE9IDAgJiYgayAhPSBtVHViZVtpXS53YXRlci5sZW5ndGgpIHsKICAgICAgICAgICAgbUFuaW0uZ3JvdXAudmlzaWJsZSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCn0KZnVuY3Rpb24gY2hlY2tUdWJlRmlsbCgpIHsKICAgIGxldCBrID0gMDsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgbVR1YmVbbVB1c2gudHViZU5vXS53YXRlci5sZW5ndGg7IGorKykgewogICAgICAgIGlmIChtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW2pdLmdyb3VwLnZpc2libGUgPT0gdHJ1ZSkgewogICAgICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW2pdLmNvbG9yICE9IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXJbaiAtIDFdLmNvbG9yKQogICAgICAgICAgICAgICAgICAgIGstLTsKICAgICAgICAgICAgfQogICAgICAgICAgICBrKys7CiAgICAgICAgfQogICAgfQogICAgaWYgKGsgPT0gbVR1YmVbbVB1c2gudHViZU5vXS53YXRlci5sZW5ndGggJiYgbUFuaW0uZ3JvdXAyLnZpc2libGUgPT0gZmFsc2UpIHsKICAgICAgICBtQW5pbS5zZXRGaWxBaW5hdGlvbihtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLngsIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSArIDEwLCBtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnopOwogICAgfQoKCgp9CmZ1bmN0aW9uIHR1YmVFbXB0eSh0YSwgdGIsIGVtdCwgZmlsKSB7CiAgICBpZiAobVR1YmVbdGFdLndhdGVyW2VtdF0uZ3JvdXAuc2NhbGUueSA+IC4wMikgewogICAgICAgIG1UdWJlW3RhXS53YXRlcltlbXRdLmdyb3VwLnNjYWxlLnkgLT0gLjA1OwogICAgICAgIGlmIChtVHViZVt0Yl0ud2F0ZXJbZmlsXS5ncm91cC5zY2FsZS55IDwgMSkgewogICAgICAgICAgICBtVHViZVt0Yl0ud2F0ZXJbZmlsXS5ncm91cC5zY2FsZS55ICs9IC4wNTsKICAgICAgICAgICAgbVR1YmVbdGJdLndhdGVyW2ZpbF0uZ3JvdXAudmlzaWJsZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChtVHViZVt0YV0ud2F0ZXJbZW10XS5ncm91cC5zY2FsZS55IDwgLjAyKSB7CiAgICAgICAgICAgIG1UdWJlW3RhXS53YXRlcltlbXRdLmdyb3VwLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgbVR1YmVbdGJdLndhdGVyW2ZpbF0uZ3JvdXAuc2NhbGUueSA9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChmaWwgPT0gMCkgewogICAgICAgICAgICBtVHViZVt0Yl0uYmFzZS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICB9Cn0KdmFyIG5ld29uZSA9IC0xOwpmdW5jdGlvbiBIYW5kbGVfR2FtZSh0eXBlKSB7CiAgICBpZiAobVBsYXllci5hbmltID09IDIpIHsKCiAgICAgICAgaWYgKHR5cGUgPT0gMCkgewogICAgICAgICAgICBtUG9wLnR1YmVObyA9IG1QdXNoLnR1YmVObzsKICAgICAgICAgICAgbmV3b25lID0gLTE7CiAgICAgICAgICAgIHZhciBjb2wgPSBbXTsKICAgICAgICAgICAgbVBsYXllci50dWJlcy5mb3JFYWNoKGVsZW1lbnQgPT4geyBjb2wucHVzaChlbGVtZW50LmNpcmNsZSk7IH0pOwogICAgICAgICAgICB2YXIgaW50ZXJzZWN0cyA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3RzKGNvbCk7CiAgICAgICAgICAgIHZhciBubyA9IC0xOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbC5sZW5ndGggJiYgaW50ZXJzZWN0cy5sZW5ndGggPiAwOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpbnRlcnNlY3RzWzBdLm9iamVjdCA9PSBjb2xbaV0pIHsKICAgICAgICAgICAgICAgICAgICBubyA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbm8gPSAtMTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtUGxheWVyLnR1YmVzLmxlbmd0aCAmJiBubyA9PSAtMTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoQ2lyY1JlY3RzT3ZlcmxhcChtUGxheWVyLnR1YmVzW2ldLmdyb3VwLnBvc2l0aW9uLngsIG1QbGF5ZXIudHViZXNbaV0uZ3JvdXAucG9zaXRpb24ueSwgMTAsIDIwMCwgKG1vdXNlLnggKiAxMTEgKiByYXRpb24pLCAobW91c2UueSAqIDkwMCksIDUpKSB7CiAgICAgICAgICAgICAgICAgICAgbm8gPSBpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxPYmoobm8pOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZSA9PSAxKSB7CiAgICAgICAgICAgIHZhciBjb2wgPSBbXTsKICAgICAgICAgICAgbVBsYXllci50dWJlcy5mb3JFYWNoKGVsZW1lbnQgPT4geyBjb2wucHVzaChlbGVtZW50LmNpcmNsZSk7IH0pOwogICAgICAgICAgICB2YXIgaW50ZXJzZWN0cyA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3RzKGNvbCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sLmxlbmd0aCAmJiBpbnRlcnNlY3RzLmxlbmd0aCA+IDA7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGludGVyc2VjdHNbMF0ub2JqZWN0ID09IGNvbFtpXSkgewogICAgICAgICAgICAgICAgICAgIG5ld29uZSA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbVBsYXllci50dWJlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKENpcmNSZWN0c092ZXJsYXAobVBsYXllci50dWJlc1tpXS5ncm91cC5wb3NpdGlvbi54LCBtUGxheWVyLnR1YmVzW2ldLmdyb3VwLnBvc2l0aW9uLnksIDEwLCAyMDAsIChtb3VzZS54ICogMTExICogcmF0aW9uKSwgKG1vdXNlLnkgKiA5MDApLCA1KSkgewogICAgICAgICAgICAgICAgICAgIG5ld29uZSA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT0gMikgewogICAgICAgICAgICBpZiAobmV3b25lID4gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChtVHViZVtuZXdvbmVdLmlzU2VsZWN0ZWQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICBzZWxPYmoobmV3b25lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobVBsYXllci5sdmwgPT0gNCkgewogICAgICAgICAgICAgIHZhciBpc1JlYWR5ID0gdHJ1ZTsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1QbGF5ZXIudHViZXMubGVuZ3RoJiZpc1JlYWR5OyBpKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKG1UdWJlW2ldLmlzVHVjaCA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgaXNSZWFkeSA9ZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYoaXNSZWFkeSl7CiAgICAgICAgICAgICAgICBjYWxsQXBwTGluaygiaU9TIik7CiAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBzZXRNb3ZlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICBzZXRNb3ZlKCk7CiAgICAgICAgICAgIH0KCgogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBzZWxlY3RUdWJlKG5vLCBpc1NlbCkgewogICAgbVR1YmVbbm9dLmlzU2VsZWN0ZWQgPSBpc1NlbDsKICAgIG1UdWJlW25vXS5ncm91cC5wb3NpdGlvbi5zZXQobVR1YmVbbm9dLmF4LCBtVHViZVtub10uYXkgKyAoaXNTZWwgPyAxMCA6IDApLCBtVHViZVtub10uYXopOwp9CmZ1bmN0aW9uIHNlbE9iaihubykgewogICAgaWYgKG5vID4gLTEpIHsKICAgICAgICB2YXIgc2VsTm8gPSAtMTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1QbGF5ZXIudHViZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1UdWJlW2ldLmlzU2VsZWN0ZWQpIHsKICAgICAgICAgICAgICAgIHNlbE5vID0gaTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2VsTm8gPiAtMSAmJiBzZWxObyAhPSBubykgewogICAgICAgICAgICBtUG9wLnR1YmVObyA9IHNlbE5vOwogICAgICAgICAgICBtUHVzaC50dWJlTm8gPSBubzsKICAgICAgICAgICAgaWYgKHNldE1vdmUoKSkKICAgICAgICAgICAgICAgIG1UdWJlW3NlbE5vXS5pc1NlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNlbGVjdFR1YmUoc2VsTm8sICFtVHViZVtzZWxOb10uaXNTZWxlY3RlZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsZWN0VHViZShubywgIW1UdWJlW25vXS5pc1NlbGVjdGVkKTsKICAgICAgICB9CiAgICAgICAgbVR1YmVbbm9dLmlzVHVjaCA9IHRydWU7CiAgICB9Cn0KZnVuY3Rpb24gc2V0TW92ZSgpIHsKICAgIHZhciBpc01vdmUgPSBmYWxzZTsKICAgIGlmIChtUHVzaC50dWJlTm8gIT0gbVBvcC50dWJlTm8pIHsKICAgICAgICBtUG9wLnJlc2V0KCk7CiAgICAgICAgZm9yIChsZXQgaSA9IG1UdWJlW21Qb3AudHViZU5vXS53YXRlci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBpZiAobVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW2ldLmdyb3VwLnZpc2libGUgPT0gdHJ1ZSAmJiBtUG9wLndObyA9PSAtMSkgewogICAgICAgICAgICAgICAgbVBvcC53Tm8gPSBpOwogICAgICAgICAgICAgICAgbVBvcC5jb2xvciA9IG1UdWJlW21Qb3AudHViZU5vXS53YXRlcltpXS5jb2xvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobVBvcC5jb2xvciA9PSBtVHViZVttUG9wLnR1YmVOb10ud2F0ZXJbaV0uY29sb3IgJiYgbVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW2ldLmdyb3VwLnZpc2libGUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgbVBvcC5ub1NhbWVDbHIrKzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICBtUHVzaC5yZXNldCgpOwogICAgICAgIGZvciAobGV0IGkgPSBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIGlmIChtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW2ldLmdyb3VwLnZpc2libGUgPT0gdHJ1ZSAmJiBtUHVzaC53Tm8gPT0gLTEpIHsKICAgICAgICAgICAgICAgIG1QdXNoLndObyA9IGk7CiAgICAgICAgICAgICAgICBtUHVzaC5jb2xvciA9IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXJbaV0uY29sb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1QdXNoLmNvbG9yID09IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXJbaV0uY29sb3IgJiYgbVR1YmVbbVB1c2gudHViZU5vXS53YXRlcltpXS5ncm91cC52aXNpYmxlID09IHRydWUpIHsKICAgICAgICAgICAgICAgIG1QdXNoLm5vU2FtZUNscisrOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1QdXNoLndObyA8IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXIubGVuZ3RoIC0gMSAmJiBtUG9wLndObyA+PSAwKSB7CiAgICAgICAgICAgIGlmIChtUG9wLm5vU2FtZUNsciArIG1QdXNoLm5vU2FtZUNsciA8PSBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyLmxlbmd0aCAmJiAobVBvcC5jb2xvciA9PSBtUHVzaC5jb2xvciB8fCBtUHVzaC5jb2xvciA9PSAtMSkpIHsKICAgICAgICAgICAgICAgIG1GbG93LnNldENvbG9yKG1Qb3AuY29sb3IpOwogICAgICAgICAgICAgICAgbVBsYXllci5hbmltID0gMDsKICAgICAgICAgICAgICAgIG1GbG93Lmdyb3VwLnBvc2l0aW9uLnNldChtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnggLSA2LCBtVHViZVttUHVzaC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLnkgKyAxNS41LCAwKTsKICAgICAgICAgICAgICAgIG1QbGF5ZXIudnggPSAobVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IC0gbVR1YmVbbVBvcC50dWJlTm9dLmdyb3VwLnBvc2l0aW9uLngpICogLjE7CiAgICAgICAgICAgICAgICBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW21QdXNoLndObyArIDFdLnNldENvbG9yKG1UdWJlW21Qb3AudHViZU5vXS53YXRlclttUG9wLndOb10uY29sb3IpOwogICAgICAgICAgICAgICAgaWYgKG1QdXNoLndObyA8IDApCiAgICAgICAgICAgICAgICAgICAgbVR1YmVbbVB1c2gudHViZU5vXS5zZXRDb2xvcihtVHViZVttUG9wLnR1YmVOb10ud2F0ZXJbbVBvcC53Tm9dLmNvbG9yKTsKICAgICAgICAgICAgICAgIGlzTW92ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBtVHViZVttUHVzaC50dWJlTm9dLmlzVHVjaCA9IG1UdWJlW21Qb3AudHViZU5vXS5pc1R1Y2ggPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1UZXhfaGFuZC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIG1UZXhfdGV4dC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIG1UZXhfZm9udHNbMV0udmlzaWJsZSA9IG1UZXhfZm9udHNbMF0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBpc01vdmU7Cn0KCmZ1bmN0aW9uIHNldFNjcmVlbihzY3IpIHsKICAgIGdhbWVyZXNldCgpOwogICAgbVRleF90ZXh0LnZpc2libGUgPW1UZXhfaGFuZC52aXNpYmxlID0gdHJ1ZTsKfQpmdW5jdGlvbiBnYW1lcmVzZXQoKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1UdWJlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbVR1YmVbaV0uZ3JvdXAudmlzaWJsZSA9IGZhbHNlOwogICAgfQogICAgbVBsYXllci5hbmltID0gMjsKICAgIG1GbG93LnJlc2V0KCk7CiAgICBtUGxheWVyLmdPdmVyID0gZmFsc2U7CiAgICBpZiAobVBsYXllci5sdmwgPT0gMSkgewogICAgICAgIHNldExldmVsT25lKCk7CiAgICB9CiAgICBpZiAobVBsYXllci5sdmwgPT0gMikgewogICAgICAgIHNldExldmVsVHdvKCk7CiAgICB9CiAgICBpZiAobVBsYXllci5sdmwgPT0gMykgewogICAgICAgIHNldExldmVsVGhyZWUoKTsKICAgIH0KICAgIGlmIChtUGxheWVyLmx2bCA9PSA0KSB7CiAgICAgIHNldExldmVsRm91cigpOwogICAgfQoKCgogICAgbVRleF9Db250aW51ZS52aXNpYmxlID0gbVBsYXllci5nT3ZlcjsKICAgIG1BbmltLnJlc2V0QWxsKG1QbGF5ZXIuZ092ZXIpOwp9CmZ1bmN0aW9uIHNldExldmVsT25lKCkgewogICAgaWYgKG1QbGF5ZXIudHViZXMubGVuZ3RoID4gMCkgewogICAgICAgIG1QbGF5ZXIudHViZXMucG9wKCk7CiAgICB9CiAgICBtUGxheWVyLnR1YmVzLmxlbmd0aCA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgIG1QbGF5ZXIudHViZXMucHVzaChtVHViZVtpXSk7CiAgICAgICAgbVR1YmVbaV0uc2V0KC0yMCArIGkgKiA0MCwgLTcwLCAwKTsKICAgICAgICBtVHViZVtpXS5zZXRXYXRlcihpICogMiwgMik7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtVHViZVtpXS53YXRlci5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgICAgICBtVHViZVtpXS53YXRlcltqXS5ncm91cC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1UdWJlW2ldLndhdGVyW2pdLmdyb3VwLnNjYWxlLnkgPSAxOwogICAgICAgICAgICAgICAgbVR1YmVbaV0uYmFzZS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1UdWJlW2ldLnNldENvbG9yKDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgbVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAuc2NhbGUueSA9IC4wMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtVHViZVtpXS53YXRlcltqXS5zZXRDb2xvcigwKTsKICAgICAgICB9CiAgICB9CiAgICBtUGxheWVyLnZ4ID0gLTI7CiAgICBtUHVzaC50dWJlTm8gPSAwOyBtUG9wLnR1YmVObyA9IDE7CiAgICBtRmxvdy5ncm91cC5wb3NpdGlvbi5zZXQobVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IC0gNiwgbVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi55ICsgMTUuNSwgMCk7Cn0KCmZ1bmN0aW9uIHNldExldmVsVHdvKCkgewogICAgaWYgKG1QbGF5ZXIudHViZXMubGVuZ3RoID4gMCkgewogICAgICAgIG1QbGF5ZXIudHViZXMucG9wKCk7CiAgICB9CiAgICBtUGxheWVyLnR1YmVzLmxlbmd0aCA9IDA7CiAgICB2YXIgY29sciA9IFtbMCwgMV0sIFstMSwgLTFdLCBbMSwgMF1dOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICBtUGxheWVyLnR1YmVzLnB1c2gobVR1YmVbaV0pOwogICAgICAgIG1UdWJlW2ldLnNldCgtMzAgKyBpICogMzAsIC03MCwgaSUyPT0wID8gLTEwIDogMTApOwogICAgICAgIG1UdWJlW2ldLmJhc2UudmlzaWJsZSA9IHRydWU7CiAgICAgICAgbVR1YmVbaV0uc2V0V2F0ZXIoaSAqIDIsIDIpOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbVR1YmVbaV0ud2F0ZXIubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgbVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAudmlzaWJsZSA9IGNvbHJbaV1bal0gPj0gMDsKICAgICAgICAgICAgaWYgKGNvbHJbaV1bal0gPj0gMCkgewogICAgICAgICAgICAgICAgbVR1YmVbaV0ud2F0ZXJbal0uc2V0Q29sb3IoY29scltpXVtqXSk7CiAgICAgICAgICAgICAgICBtVHViZVtpXS53YXRlcltqXS5ncm91cC5zY2FsZS55ID0gMTsKICAgICAgICAgICAgICAgIGlmIChqID09IDApIHsKICAgICAgICAgICAgICAgICAgICBtVHViZVtpXS5zZXRDb2xvcihjb2xyW2ldW2pdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1UdWJlW2ldLndhdGVyW2pdLmdyb3VwLnNjYWxlLnkgPSAuMDE7CiAgICAgICAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbVR1YmVbaV0uYmFzZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBtUGxheWVyLnZ4ID0gLTI7CiAgICBtUHVzaC50dWJlTm8gPSAwOyBtUG9wLnR1YmVObyA9IDE7CiAgICBtRmxvdy5ncm91cC5wb3NpdGlvbi5zZXQobVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi54IC0gNiwgbVR1YmVbbVB1c2gudHViZU5vXS5ncm91cC5wb3NpdGlvbi55ICsgMTUuNSwgMCk7Cn0KZnVuY3Rpb24gc2V0TGV2ZWxUaHJlZSgpIHsKICAgIGlmIChtUGxheWVyLnR1YmVzLmxlbmd0aCA+IDApIHsKICAgICAgICBtUGxheWVyLnR1YmVzLnBvcCgpOwogICAgfQogICAgbVBsYXllci50dWJlcy5sZW5ndGggPSAwOwogICAgdmFyIGNvbHIgPSBbWzMsIDMsIC0xXSwgWzAsIDMsIDBdLCBbMCwgLTEsIC0xXV07CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIG1QbGF5ZXIudHViZXMucHVzaChtVHViZVtpXSk7CiAgICAgICAgbVR1YmVbaV0uc2V0KC0zMCArIGkgKiAzMCwgaSA9PSAxID8gLTc1IDogLTY1LCAwKTsKICAgICAgICBtVHViZVtpXS5iYXNlLnZpc2libGUgPSB0cnVlOwogICAgICAgIG1UdWJlW2ldLnNldFdhdGVyKGkgKiAzLCAzKTsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG1UdWJlW2ldLndhdGVyLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIG1UdWJlW2ldLndhdGVyW2pdLmdyb3VwLnZpc2libGUgPSBjb2xyW2ldW2pdID49IDA7CiAgICAgICAgICAgIGlmIChjb2xyW2ldW2pdID49IDApIHsKICAgICAgICAgICAgICAgIG1UdWJlW2ldLndhdGVyW2pdLnNldENvbG9yKGNvbHJbaV1bal0pOwogICAgICAgICAgICAgICAgbVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAuc2NhbGUueSA9IDE7CiAgICAgICAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbVR1YmVbaV0uc2V0Q29sb3IoY29scltpXVtqXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtVHViZVtpXS53YXRlcltqXS5ncm91cC5zY2FsZS55ID0gLjAxOwogICAgICAgICAgICAgICAgaWYgKGogPT0gMCkgewogICAgICAgICAgICAgICAgICAgIG1UdWJlW2ldLmJhc2UudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgbVBsYXllci52eCA9IC0yOwogICAgbVB1c2gudHViZU5vID0gMDsgbVBvcC50dWJlTm8gPSAxOwogICAgbUZsb3cuZ3JvdXAucG9zaXRpb24uc2V0KG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCAtIDYsIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSArIDE1LjUsIDApOwp9CmZ1bmN0aW9uIHNldExldmVsRm91cigpIHsKICAgIGlmIChtUGxheWVyLnR1YmVzLmxlbmd0aCA+IDApIHsKICAgICAgICBtUGxheWVyLnR1YmVzLnBvcCgpOwogICAgfQogICAgbVBsYXllci50dWJlcy5sZW5ndGggPSAwOwogICAgdmFyIGNvbHIgPSBbWzIsIDEsIDJdLCBbMSwgLTEsIC0xXSwgWzMsIDMsIC0xXSwgWzAsIDMsIDBdLCBbMCwgMiwgMV1dOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbVBsYXllci50dWJlcy5wdXNoKG1UdWJlW2ldKTsKICAgICAgICBpZihpPT0yKXsKICAgICAgICAgIG1UdWJlW2ldLnNldCgtNDAgKyBpICogMjAsIC03MCwgIC0yMCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBtVHViZVtpXS5zZXQoLTQwICsgaSAqIDIwLCAtNzAsICBpJTI9PTAgPyAtMTAgOiAxMCk7CiAgICAgICAgfQoKICAgICAgICBtVHViZVtpXS5iYXNlLnZpc2libGUgPSB0cnVlOwogICAgICAgIG1UdWJlW2ldLnNldFdhdGVyKGkgKiAzLCAzKTsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG1UdWJlW2ldLndhdGVyLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIG1UdWJlW2ldLndhdGVyW2pdLmdyb3VwLnZpc2libGUgPSBjb2xyW2ldW2pdID49IDA7CiAgICAgICAgICAgIGlmIChjb2xyW2ldW2pdID49IDApIHsKICAgICAgICAgICAgICAgIG1UdWJlW2ldLndhdGVyW2pdLnNldENvbG9yKGNvbHJbaV1bal0pOwogICAgICAgICAgICAgICAgbVR1YmVbaV0ud2F0ZXJbal0uZ3JvdXAuc2NhbGUueSA9IDE7CiAgICAgICAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbVR1YmVbaV0uc2V0Q29sb3IoY29scltpXVtqXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtVHViZVtpXS53YXRlcltqXS5ncm91cC5zY2FsZS55ID0gLjAxOwogICAgICAgICAgICAgICAgaWYgKGogPT0gMCkgewogICAgICAgICAgICAgICAgICAgIG1UdWJlW2ldLmJhc2UudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgbVBsYXllci52eCA9IC0yOwogICAgbVB1c2gudHViZU5vID0gMDsgbVBvcC50dWJlTm8gPSAxOwogICAgbUZsb3cuZ3JvdXAucG9zaXRpb24uc2V0KG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCAtIDYsIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSArIDE1LjUsIDApOwp9CmZ1bmN0aW9uIEhhbmRsZV9NZW51KGNsaWNrdmFsKSB7CiAgY29uc29sZS5sb2coImNsaWNrdmFsID0gIitjbGlja3ZhbCkKICBpZihjbGlja3ZhbD09MTIpewpjYWxsQXBwTGluaygiaU9TIik7CiAgfWVsc2V7CiAgICBpZiAobVBsYXllci5sdmwgPCA0KSB7CiAgICAgICAgbVBsYXllci5sdmwrKzsKICAgICAgICBpZihtUGxheWVyLmx2bCA9PSAzKXsKICAgICAgICAgIG1QbGF5ZXIubHZsKys7CiAgICAgICAgfQogICAgICAgIGdhbWVyZXNldCgpOwogICAgfSBlbHNlIHsKICAgICAgY2FsbEFwcExpbmsoImlPUyIpOwogICAgfQogIH0KfQpmdW5jdGlvbiBIYW5kbGVfR2FtZV9vbGQodHlwZSkgewogICAgaWYgKG1QbGF5ZXIuYW5pbSA9PSAyKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gMCkgewogICAgICAgICAgICBtUG9wLnR1YmVObyA9IG1QdXNoLnR1YmVObzsKICAgICAgICAgICAgdmFyIGNvbCA9IFtdOwogICAgICAgICAgICBtUGxheWVyLnR1YmVzLmZvckVhY2goZWxlbWVudCA9PiB7IGNvbC5wdXNoKGVsZW1lbnQuY2lyY2xlKTsgfSk7CiAgICAgICAgICAgIHZhciBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHMoY29sKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2wubGVuZ3RoICYmIGludGVyc2VjdHMubGVuZ3RoID4gMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaW50ZXJzZWN0c1swXS5vYmplY3QgPT0gY29sW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgbVBvcC50dWJlTm8gPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG1QdXNoLnR1YmVObyA9IG1Qb3AudHViZU5vOwogICAgICAgICAgICAvLyBzZWxlY3RUdWJlKG1Qb3AudHViZU5vKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT0gMSkgewogICAgICAgICAgICB2YXIgY29sID0gW107CiAgICAgICAgICAgIG1QbGF5ZXIudHViZXMuZm9yRWFjaChlbGVtZW50ID0+IHsgY29sLnB1c2goZWxlbWVudC5jaXJjbGUpOyB9KTsKICAgICAgICAgICAgdmFyIGludGVyc2VjdHMgPSByYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0cyhjb2wpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbC5sZW5ndGggJiYgaW50ZXJzZWN0cy5sZW5ndGggPiAwOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpbnRlcnNlY3RzWzBdLm9iamVjdCA9PSBjb2xbaV0pIHsKICAgICAgICAgICAgICAgICAgICBtUHVzaC50dWJlTm8gPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlID09IDIpIHsKICAgICAgICAgICAgaWYgKG1QdXNoLnR1YmVObyAhPSBtUG9wLnR1YmVObykgewogICAgICAgICAgICAgICAgbVBvcC5yZXNldCgpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IG1UdWJlW21Qb3AudHViZU5vXS53YXRlci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmIChtVHViZVttUG9wLnR1YmVOb10ud2F0ZXJbaV0uZ3JvdXAudmlzaWJsZSA9PSB0cnVlICYmIG1Qb3Aud05vID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1Qb3Aud05vID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgbVBvcC5jb2xvciA9IG1UdWJlW21Qb3AudHViZU5vXS53YXRlcltpXS5jb2xvcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG1Qb3AuY29sb3IgPT0gbVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW2ldLmNvbG9yICYmIG1UdWJlW21Qb3AudHViZU5vXS53YXRlcltpXS5ncm91cC52aXNpYmxlID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbVBvcC5ub1NhbWVDbHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1QdXNoLnJlc2V0KCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gbVR1YmVbbVB1c2gudHViZU5vXS53YXRlci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmIChtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW2ldLmdyb3VwLnZpc2libGUgPT0gdHJ1ZSAmJiBtUHVzaC53Tm8gPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbVB1c2gud05vID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgbVB1c2guY29sb3IgPSBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW2ldLmNvbG9yOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobVB1c2guY29sb3IgPT0gbVR1YmVbbVB1c2gudHViZU5vXS53YXRlcltpXS5jb2xvciAmJiBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW2ldLmdyb3VwLnZpc2libGUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtUHVzaC5ub1NhbWVDbHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1QdXNoLndObyA8IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXIubGVuZ3RoIC0gMSAmJiBtUG9wLndObyA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1Qb3Aubm9TYW1lQ2xyICsgbVB1c2gubm9TYW1lQ2xyIDw9IG1UdWJlW21QdXNoLnR1YmVOb10ud2F0ZXIubGVuZ3RoICYmIChtUG9wLmNvbG9yID09IG1QdXNoLmNvbG9yIHx8IG1QdXNoLmNvbG9yID09IC0xKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtRmxvdy5zZXRDb2xvcihtUG9wLmNvbG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgbVBsYXllci5hbmltID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgbUZsb3cuZ3JvdXAucG9zaXRpb24uc2V0KG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCAtIDYsIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSArIDE1LjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBtUGxheWVyLnZ4ID0gKG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueCAtIG1UdWJlW21Qb3AudHViZU5vXS5ncm91cC5wb3NpdGlvbi54KSAqIC4xOwogICAgICAgICAgICAgICAgICAgICAgICBtVHViZVttUHVzaC50dWJlTm9dLndhdGVyW21QdXNoLndObyArIDFdLnNldENvbG9yKG1UdWJlW21Qb3AudHViZU5vXS53YXRlclttUG9wLndOb10uY29sb3IpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobVB1c2gud05vIDwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1UdWJlW21QdXNoLnR1YmVOb10uc2V0Q29sb3IobVR1YmVbbVBvcC50dWJlTm9dLndhdGVyW21Qb3Aud05vXS5jb2xvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1UZXhfdGV4dC52aXNpYmxlID0gbVRleF9oYW5kLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBtVGV4X2ZvbnRzWzFdLnZpc2libGUgPSBtVGV4X2ZvbnRzWzBdLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBsb2FkVUkoYXNzZXRwYXRoLCB4LCB5LCBjbGlja3ZhbCkgewogICAgdmFyIHNwcml0ZSA9IGdhbWVVSS5jcmVhdGVTcHJpdGUoYXNzZXRwYXRoKTsKICAgIHNwcml0ZS5hbHBoYSA9IDE7CiAgICBzcHJpdGUueCA9IHg7CiAgICBzcHJpdGUueSA9IHk7CiAgICBzcHJpdGUud2lkdGggPSBzcHJpdGUud2lkdGggKiAuODU7CiAgICBzcHJpdGUuaGVpZ2h0ID0gc3ByaXRlLmhlaWdodCAqIC44NTsKICAgIHNwcml0ZS5waXZvdC54ID0gMC41OwogICAgc3ByaXRlLnBpdm90LnkgPSAwLjU7CiAgICBzcHJpdGUuYW5jaG9yLnggPSBUaHJlZVVJLmFuY2hvcnMuY2VudGVyOwogICAgc3ByaXRlLmFuY2hvci55ID0gVGhyZWVVSS5hbmNob3JzLmNlbnRlcjsKICAgIHNwcml0ZS52aXNpYmxlID0gZmFsc2U7CiAgICBzcHJpdGUuYWxwaGEgPSAxOwogICAgaWYgKGNsaWNrdmFsID4gMCkKICAgICAgICBzcHJpdGUub25DbGljaygoKSA9PiB7IEhhbmRsZV9NZW51KGNsaWNrdmFsKTsgfSk7CiAgICByZXR1cm4gc3ByaXRlOwp9CmZ1bmN0aW9uIGNyZWF0ZVRleHRzKHRleHQsIHNpemUsIGNvbG9yLCBhbmNob3J4LCBhbmNob3J5LCB0ZXh0QWxpZ24sIHRweWUpIHsKICAgIHZhciBsYmx0ZXh0ID0gdGhpcy5nYW1lVUkuY3JlYXRlVGV4dCh0ZXh0LCBzaXplLCB0cHllLCBjb2xvcik7CiAgICBsYmx0ZXh0LmFuY2hvci54ID0gYW5jaG9yeDsKICAgIGxibHRleHQuYW5jaG9yLnkgPSBhbmNob3J5OwogICAgbGJsdGV4dC50ZXh0QWxpZ24gPSB0ZXh0QWxpZ247CiAgICBsYmx0ZXh0LnZpc2libGUgPSBmYWxzZTsKICAgIHJldHVybiBsYmx0ZXh0Owp9CmZ1bmN0aW9uIERyYXdUZXh0dXJlKHRleCwgeCwgeSwgc3gsIHN5KSB7CiAgICB0ZXgueCA9IHg7CiAgICB0ZXgueSA9IHk7CiAgICB0ZXgud2lkdGggPSBzeDsKICAgIHRleC5oZWlnaHQgPSBzeTsKICAgIHRleC52aXNpYmxlID0gdHJ1ZTsKfQpmdW5jdGlvbiBEcmF3VGV4dHVyZVModGV4LCBzeCwgc3kpIHsKICAgIHRleC53aWR0aCA9IHN4OwogICAgdGV4LmhlaWdodCA9IHN5OwogICAgdGV4LnZpc2libGUgPSB0cnVlOwp9CmZ1bmN0aW9uIERyYXdMYmwodGV4LCBsYmwsIHgsIHksIGNvbG9yLCBzaXopIHsKICAgIHRleC54ID0geDsKICAgIHRleC55ID0geTsKICAgIHRleC50ZXh0ID0gbGJsOwogICAgdGV4LmNvbG9yID0gY29sb3IgfHwgJyNmYWZhZmEnOwogICAgdGV4LnNpemUgPSBzaXogfHwgNTA7CiAgICB0ZXguYW5jaG9yLnggPSBUaHJlZVVJLmFuY2hvcnMuY2VudGVyOwogICAgdGV4LmFuY2hvci55ID0gVGhyZWVVSS5hbmNob3JzLmNlbnRlcjsKICAgIHRleC52aXNpYmxlID0gdHJ1ZTsKfQpmdW5jdGlvbiBDaXJjUmVjdHNPdmVybGFwKENSWCwgQ1JZLCBDUkRYLCBDUkRZLCBjZW50ZXJYLCBjZW50ZXJZLCByYWRpdXMpIHsKICAgIGlmICgoTWF0aC5hYnMoY2VudGVyWCAtIENSWCkgPD0gKENSRFggKyByYWRpdXMpKSAmJiAoTWF0aC5hYnMoY2VudGVyWSAtIENSWSkgPD0gKENSRFkgKyByYWRpdXMpKSkKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiByYW5kcyhtYXgpIHsKICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXgpOwp9CmZ1bmN0aW9uIHdDb2xvcihjbHIpIHsKICAgIGNvbG9ycyA9IFsncmdiKDI1NSwwLDApJywgJ3JnYigyNTUsMTI3LDApJywgJ3JnYigyMiwxMDQsMjMzKScsICdyZ2IoMCwyNTUsMjU1KScsCiAgICAgICAgJ3JnYig4NSwyNTMsMCknLCAncmdiKDI1NSwyNTUsMCknLCAncmdiKDI1NSwwLDI1NSknLCAncmdiKDE1MCwwLDI1NSknXTsKICAgIHJldHVybiBuZXcgVEhSRUUuQ29sb3IoY29sb3JzW2Nscl0pOwp9CmZ1bmN0aW9uIGxvYWRNb2RlbCgpIHsgfQpmdW5jdGlvbiBsb2FkVGV4dHVyZShzdHIpIHsKICAgIGxldCBpbWFnZSA9IG5ldyBJbWFnZSgpOyBpbWFnZS5zcmMgPSBzdHI7CiAgICBjb25zdCB0ZXh0dXJlID0gbmV3IFRIUkVFLlRleHR1cmUoKTsKICAgIHRleHR1cmUuaW1hZ2UgPSBpbWFnZTsKICAgIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsgdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7IH07CiAgICByZXR1cm4gdGV4dHVyZTsKfQpmdW5jdGlvbiBDdXN0b21TaW5DdXJ2ZShzY2FsZSkgewogICAgVEhSRUUuQ3VydmUuY2FsbCh0aGlzKTsKICAgIHRoaXMuc2NhbGUgPSAoc2NhbGUgPT09IHVuZGVmaW5lZCkgPyAxIDogc2NhbGU7Cn0KZnVuY3Rpb24gQ3JlYXRldHViZShtYXRlcmlhbCkgewogICAgQ3VzdG9tU2luQ3VydmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShUSFJFRS5DdXJ2ZS5wcm90b3R5cGUpOwogICAgQ3VzdG9tU2luQ3VydmUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3VzdG9tU2luQ3VydmU7CiAgICBDdXN0b21TaW5DdXJ2ZS5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciB0eCA9IHQgKiAxOwogICAgICAgIHZhciB0eSA9IDA7CiAgICAgICAgdmFyIHR6ID0gMDsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjModHgsIHR5LCB0eikubXVsdGlwbHlTY2FsYXIodGhpcy5zY2FsZSk7CiAgICB9OwogICAgdmFyIHBhdGggPSBuZXcgQ3VzdG9tU2luQ3VydmUoMjQpOwogICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlR1YmVHZW9tZXRyeShwYXRoLCAzMiwgNC41LCA4LCBmYWxzZSk7CiAgICB2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICBtZXNoLnJvdGF0aW9uLnNldCgwLCAwLCAtTWF0aC5QSSAqIC41KTsKICAgIHNjZW5lLmFkZChtZXNoKTsKICAgIHJldHVybiBtZXNoOwp9CgpjbGFzcyBUdWJlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHZhciBibGVuZGluZ3MgPSBbCiAgICAgICAgICAgIHsgbmFtZTogJ05vJywgY29uc3RhbnQ6IFRIUkVFLk5vQmxlbmRpbmcgfSwKICAgICAgICAgICAgeyBuYW1lOiAnTm9ybWFsJywgY29uc3RhbnQ6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0sCiAgICAgICAgICAgIHsgbmFtZTogJ0FkZGl0aXZlJywgY29uc3RhbnQ6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgfSwKICAgICAgICAgICAgeyBuYW1lOiAnU3VidHJhY3RpdmUnLCBjb25zdGFudDogVEhSRUUuU3VidHJhY3RpdmVCbGVuZGluZyB9LAogICAgICAgICAgICB7IG5hbWU6ICdNdWx0aXBseScsIGNvbnN0YW50OiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nIH0KICAgICAgICBdOwogICAgICAgIHRoaXMubWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmZmYsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIHRyYW5zcGFyZW50OiB0cnVlLCBtYXA6IGxvYWRUZXh0dXJlKFRSQUNfNjQpIH0pOwogICAgICAgIHRoaXMuZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICB2YXIgZXh0cnVkZVNldHRpbmdzID0geyBkZXB0aDogMSwgYmV2ZWxFbmFibGVkOiB0cnVlLCBiZXZlbFNlZ21lbnRzOiAxMCwgc3RlcHM6IDIsIGJldmVsU2l6ZTogMSwgYmV2ZWxUaGlja25lc3M6IDEyIH07CiAgICAgICAgdmFyIHNtaWxleVNoYXBlID0gbmV3IFRIUkVFLlNoYXBlKCk7CiAgICAgICAgc21pbGV5U2hhcGUubW92ZVRvKDAsIDApCiAgICAgICAgc21pbGV5U2hhcGUuYWJzYXJjKDAsIDAsIDQsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7CiAgICAgICAgdmFyIHNtaWxleUV5ZTFQYXRoID0gbmV3IFRIUkVFLlBhdGgoKTsKICAgICAgICBzbWlsZXlFeWUxUGF0aC5tb3ZlVG8oMCwgMCkKICAgICAgICBzbWlsZXlFeWUxUGF0aC5hYnNlbGxpcHNlKDAsIDAsIDMuOCwgMy44LCAwLCBNYXRoLlBJICogMiwgdHJ1ZSk7CiAgICAgICAgc21pbGV5U2hhcGUuaG9sZXMucHVzaChzbWlsZXlFeWUxUGF0aCk7CiAgICAgICAgdGhpcy5jaXJjbGUgPSBDcmVhdGV0dWJlKHRoaXMubWF0ZXJpYWwpOy8vdGhpcy5hZGRTaGFwZShzbWlsZXlTaGFwZSwgZXh0cnVkZVNldHRpbmdzLCAwLCAwLCAwLCBNYXRoLlBJICogLjUsIDAsIDAsIDEpOwogICAgICAgIHRoaXMuY2lyY2xlLnBvc2l0aW9uLnNldCgwLCAxMiwgMCk7CiAgICAgICAgdmFyIHNtaWxleVNoYXBlMiA9IG5ldyBUSFJFRS5TaGFwZSgpOwogICAgICAgIHNtaWxleVNoYXBlMi5tb3ZlVG8oMCwgMCkKICAgICAgICBzbWlsZXlTaGFwZTIuYWJzYXJjKDAsIDAsIDQsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7CiAgICAgICAgdGhpcy5jaXJjbGUyID0gdGhpcy5hZGRTaGFwZShzbWlsZXlTaGFwZTIsIGV4dHJ1ZGVTZXR0aW5ncywgMCwgMCwgMCwgTWF0aC5QSSAqIC41LCAwLCAwLCAxKTsKICAgICAgICB0aGlzLmNpcmNsZTIuc2NhbGUuc2V0KC4yLCAuMiwgLjYpOwogICAgICAgIHRoaXMuY2lyY2xlMi5wb3NpdGlvbi5zZXQoMCwgLTIyLCAwKTsKICAgICAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoNCwgMzIsIDMyLCAwLCBNYXRoLlBJLCAwLCBNYXRoLlBJKTsKICAgICAgICB0aGlzLm9iamVjdCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsKTsKICAgICAgICB0aGlzLm9iamVjdC5wb3NpdGlvbi5zZXQoMCwgLTEyLCAwKTsKICAgICAgICB0aGlzLm9iamVjdC5yb3RhdGlvbi5zZXQoTWF0aC5QSSAqIC41LCAwLCAwKTsKICAgICAgICB2YXIgbWF0ZXJpYWxjdXAgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmMDAgfSk7CiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KDQsIDMyLCAzMiwgMCwgTWF0aC5QSSwgMCwgTWF0aC5QSSk7CiAgICAgICAgdGhpcy5iYXNlID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsY3VwKTsKICAgICAgICB0aGlzLmJhc2UucG9zaXRpb24uc2V0KDAsIC0xMiwgMCk7CiAgICAgICAgdGhpcy5iYXNlLnJvdGF0aW9uLnNldChNYXRoLlBJICogLjUsIDAsIDApOwogICAgICAgIHRoaXMuZ3JvdXAuYWRkKHRoaXMuYmFzZSk7CiAgICAgICAgdGhpcy5vYmplY3QyID0gdGhpcy5vYmplY3QuY2xvbmUoKTsKICAgICAgICB0aGlzLm9iamVjdDIucG9zaXRpb24uc2V0KDAsIC0zMSwgMCk7CiAgICAgICAgdGhpcy5vYmplY3QyLnJvdGF0aW9uLnNldChNYXRoLlBJICogMS41LCAwLCAwKTsKICAgICAgICB0aGlzLm9iamVjdDIuc2NhbGUuc2V0KDEsIDEsIC42KTsKICAgICAgICB0aGlzLmdyb3VwLmFkZCh0aGlzLmNpcmNsZSk7CiAgICAgICAgdGhpcy5ncm91cC5hZGQodGhpcy5vYmplY3QpOwogICAgICAgIHRoaXMuZ3JvdXAuYWRkKHRoaXMuY2lyY2xlMik7CiAgICAgICAgdGhpcy5ncm91cC5hZGQodGhpcy5vYmplY3QyKTsKICAgICAgICB0aGlzLndhdGVyID0gW107CiAgICAgICAgc2NlbmUuYWRkKHRoaXMuZ3JvdXApOwogICAgICAgIHRoaXMuYXggPSAwOwogICAgICAgIHRoaXMuYXkgPSAwOwogICAgICAgIHRoaXMuZ3JvdXAudmlzaWJsZSA9IGZhbHNlOwogICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuaXNUdWNoID0gZmFsc2U7CiAgICB9CiAgICBhZGRTaGFwZShzaGFwZSwgZXh0cnVkZVNldHRpbmdzLCB4LCB5LCB6LCByeCwgcnksIHJ6LCBzKSB7CiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkV4dHJ1ZGVCdWZmZXJHZW9tZXRyeShzaGFwZSwgZXh0cnVkZVNldHRpbmdzKTsKICAgICAgICB2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsKTsKICAgICAgICBtZXNoLnBvc2l0aW9uLnNldCh4LCB5LCB6KTsKICAgICAgICBtZXNoLnJvdGF0aW9uLnNldChyeCwgcnksIHJ6KTsKICAgICAgICBtZXNoLnNjYWxlLnNldChzLCBzLCBzKTsKICAgICAgICByZXR1cm4gbWVzaDsKICAgIH0KICAgIHNldChfeCwgX3ksIF96KSB7CiAgICAgICAgdGhpcy5heCA9IF94OwogICAgICAgIHRoaXMuYXkgPSBfeTsKICAgICAgICB0aGlzLmF6ID0gX3o7CiAgICAgICAgdGhpcy5ncm91cC5wb3NpdGlvbi5zZXQoX3gsIF95LCBfeik7CiAgICAgICAgdGhpcy5ncm91cC5yb3RhdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgdGhpcy5ncm91cC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmlzVHVjaCA9IGZhbHNlOwogICAgfQogICAgc2V0V2F0ZXIobm8sIG5vQ29sb3IpIHsKICAgICAgICBpZiAodGhpcy53YXRlci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGxldCBvYmogPSB0aGlzLndhdGVyLnBvcCgpOwogICAgICAgICAgICB0aGlzLmdyb3VwLnJlbW92ZShvYmouZ3JvdXApOwogICAgICAgIH0KICAgICAgICB0aGlzLndhdGVyLmxlbmd0aCA9IDA7CiAgICAgICAgdmFyIHZhbCA9IDIyIC8gbm9Db2xvcjsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vQ29sb3I7IGkrKykgewogICAgICAgICAgICB0aGlzLndhdGVyLnB1c2gobUdhbWVXYXRlcnNbaSArIG5vXSk7CiAgICAgICAgICAgIHRoaXMud2F0ZXJbaV0uY3lsLnBvc2l0aW9uLnNldCgwLCB2YWwgKiAuNSwgMCk7CiAgICAgICAgICAgIHRoaXMud2F0ZXJbaV0uY3lsLnNjYWxlLnNldCgxLCB2YWwsIDEpOwogICAgICAgICAgICB0aGlzLmdyb3VwLmFkZCh0aGlzLndhdGVyW2ldLmdyb3VwKTsKICAgICAgICAgICAgdGhpcy53YXRlcltpXS5ncm91cC5wb3NpdGlvbi5zZXQoMCwgLTEyICsgaSAqIHZhbCwgMCk7CiAgICAgICAgfQogICAgfQogICAgc2V0Q29sb3IoY2xyKSB7CiAgICAgICAgdGhpcy5iYXNlLnRyYXZlcnNlKGZ1bmN0aW9uIChjaGlsZCkgeyBpZiAoY2hpbGQuaXNNZXNoKSB7IGNoaWxkLm1hdGVyaWFsLmNvbG9yID0gd0NvbG9yKGNscik7IH0gfSk7CiAgICB9Cn0KY2xhc3MgV2F0ZXIgewogICAgY29uc3RydWN0b3IodmFsKSB7CiAgICAgICAgdGhpcy5ncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDQuNCwgNC40LCAxLCA4KTsKICAgICAgICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmMDAgfSk7CiAgICAgICAgdGhpcy5jeWwgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICAgIHRoaXMuY3lsLnBvc2l0aW9uLnNldCgwLCB2YWwgKiAuNSwgMCk7CiAgICAgICAgdGhpcy5jeWwuc2NhbGUuc2V0KDEsIHZhbCwgMSk7CiAgICAgICAgdGhpcy5ncm91cC5hZGQodGhpcy5jeWwpOwogICAgICAgIHRoaXMuZ3JvdXAuc2NhbGUuc2V0KDEsIDEsIDEpOwogICAgICAgIHRoaXMuY29sb3IgPSAwOwogICAgfQogICAgc2V0Q29sb3IoY2xyKSB7CiAgICAgICAgdGhpcy5jeWwudHJhdmVyc2UoZnVuY3Rpb24gKGNoaWxkKSB7IGlmIChjaGlsZC5pc01lc2gpIHsgY2hpbGQubWF0ZXJpYWwuY29sb3IgPSB3Q29sb3IoY2xyKTsgfSB9KTsKICAgICAgICB0aGlzLmNvbG9yID0gY2xyOwogICAgfQp9CmNsYXNzIFB1c2hQb3AgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy50dWJlTm8gPSAxOwogICAgICAgIHRoaXMud05vID0gMTsKICAgICAgICB0aGlzLmNvbG9yID0gMDsKICAgICAgICB0aGlzLm5vU2FtZUNsciA9IDA7CiAgICB9CiAgICByZXNldCgpIHsKICAgICAgICB0aGlzLndObyA9IC0xOwogICAgICAgIHRoaXMuY29sb3IgPSAtMTsKICAgICAgICB0aGlzLm5vU2FtZUNsciA9IDA7CiAgICB9Cn0KY2xhc3MgUGxheWVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuYW5pbWF0aW9uID0gMTsKICAgICAgICB0aGlzLnR1YmVzID0gW107CiAgICAgICAgdGhpcy5sdmwgPSAxOwogICAgICAgIHRoaXMudnggPSAtLjEwOwogICAgICAgIHRoaXMuZ092ZXIgPSBmYWxzZTsKICAgIH0KfQpjbGFzcyBGbG93IHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICB0aGlzLm1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZjAwIH0pOwogICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEsIDEsIDYsIDgpOwogICAgICAgIHRoaXMuY3lsMSA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsKTsKICAgICAgICB0aGlzLmN5bDMgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCk7CiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KDEuNCwgMzIsIDMyKTsKICAgICAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuVG9ydXNCdWZmZXJHZW9tZXRyeSgyLCAxLjQsIDQsIDgsIE1hdGguUEkgKiAuNik7CiAgICAgICAgdGhpcy5jeWwyID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwpOwogICAgICAgIHRoaXMuY3lsNCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsKTsKICAgICAgICB0aGlzLmN5bDEucG9zaXRpb24uc2V0KDAsIC0zLCAwKTsKICAgICAgICB0aGlzLmdjeWwxID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgdGhpcy5nY3lsMS5hZGQodGhpcy5jeWwxKTsKICAgICAgICB0aGlzLmdjeWwxLnBvc2l0aW9uLnNldCgyLjYsIDQsIDApOwogICAgICAgIHRoaXMuZ2N5bDEucm90YXRpb24uc2V0KDAsIDAsIC0xLjIpOwogICAgICAgIHRoaXMuZ2N5bDMgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICB0aGlzLmN5bDMucG9zaXRpb24uc2V0KDAsIC0zLCAwKTsKICAgICAgICB0aGlzLmdjeWwzLmFkZCh0aGlzLmN5bDMpOwogICAgICAgIHRoaXMuZ2N5bDMucG9zaXRpb24uc2V0KDMuOCwgMy4zLCAwKTsKICAgICAgICB0aGlzLmdyb3VwLmFkZCh0aGlzLmdjeWwxKTsKICAgICAgICB0aGlzLmdyb3VwLmFkZCh0aGlzLmN5bDIpOwogICAgICAgIHRoaXMuZ3JvdXAuYWRkKHRoaXMuZ2N5bDMpOwogICAgICAgIHRoaXMuZ3JvdXAuYWRkKHRoaXMuY3lsNCk7CiAgICAgICAgdGhpcy5jeWwyLnBvc2l0aW9uLnNldCgyLjEsIDIuMywgMCk7CiAgICAgICAgdGhpcy5jeWw0LnBvc2l0aW9uLnNldCgzLjksIDMuMywgMCk7CiAgICAgICAgdGhpcy5ncm91cC5zY2FsZS5zZXQoMSwgMSwgMSk7CiAgICAgICAgdGhpcy5ncm91cC5wb3NpdGlvbi5zZXQoOSwgMTUuNSwgMCk7CiAgICAgICAgc2NlbmUuYWRkKHRoaXMuZ3JvdXApOwogICAgICAgIHRoaXMucmVzZXQoKTsKICAgIH0KICAgIHJlc2V0KCkgewogICAgICAgIHRoaXMuZ2N5bDEudmlzaWJsZSA9IGZhbHNlOwogICAgICAgIHRoaXMuY3lsMi52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgdGhpcy5nY3lsMy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgdGhpcy5jeWw0LnZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLmdjeWwxLnBvc2l0aW9uLnNldCgtMjAuNiwgLTQuNiwgMCk7CiAgICAgICAgdGhpcy5nY3lsMS5zY2FsZS5zZXQoMS40LCAtMC4yLCAxLjQpOy8vLTQuMgogICAgICAgIHRoaXMuZ2N5bDMuc2NhbGUuc2V0KDEuNCwgLjAxLCAxLjQpOwogICAgfQogICAgc2V0Q29sb3IoY2xyKSB7CiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IHdDb2xvcihjbHIpOwogICAgICAgIHRoaXMuZ2N5bDEudHJhdmVyc2UoZnVuY3Rpb24gKGNoaWxkKSB7IGlmIChjaGlsZC5pc01lc2gpIHsgY2hpbGQubWF0ZXJpYWwuY29sb3IgPSB3Q29sb3IoY2xyKTsgfSB9KTsKICAgICAgICB0aGlzLmN5bDIudHJhdmVyc2UoZnVuY3Rpb24gKGNoaWxkKSB7IGlmIChjaGlsZC5pc01lc2gpIHsgY2hpbGQubWF0ZXJpYWwuY29sb3IgPSB3Q29sb3IoY2xyKTsgfSB9KTsKICAgICAgICB0aGlzLmdjeWwzLnRyYXZlcnNlKGZ1bmN0aW9uIChjaGlsZCkgeyBpZiAoY2hpbGQuaXNNZXNoKSB7IGNoaWxkLm1hdGVyaWFsLmNvbG9yID0gd0NvbG9yKGNscik7IH0gfSk7CiAgICAgICAgdGhpcy5jeWw0LnRyYXZlcnNlKGZ1bmN0aW9uIChjaGlsZCkgeyBpZiAoY2hpbGQuaXNNZXNoKSB7IGNoaWxkLm1hdGVyaWFsLmNvbG9yID0gd0NvbG9yKGNscik7IH0gfSk7CiAgICB9Cgp9CmNsYXNzIEFuaW1hdGlvbiB7CiAgICBjb25zdHJ1Y3Rvcih2YWwpIHsKICAgICAgICB0aGlzLmdyb3VwID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgdGhpcy5vYmogPSBbXTsKICAgICAgICB0aGlzLm9iakxvbmcgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEyMDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMub2JqLnB1c2godGhpcy5jcmVhdGVPYmooMyArIHJhbmRzKDgpKSk7CiAgICAgICAgICAgIHRoaXMub2JqW2ldLnBvc2l0aW9uLnNldCgtMTAwICsgaSAqIDEwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5vYmpbaV0udnggPSAwLjE7CiAgICAgICAgICAgIHRoaXMub2JqW2ldLnZ5ID0gMS45OwogICAgICAgICAgICB0aGlzLm9ialtpXS52eiA9IDA7CiAgICAgICAgICAgIHRoaXMub2JqW2ldLnJvdCA9IDA7CiAgICAgICAgICAgIHRoaXMub2JqW2ldLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRyaWFuZ2xlU2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoKQogICAgICAgIHRyaWFuZ2xlU2hhcGUubW92ZVRvKDAsIDApCiAgICAgICAgdHJpYW5nbGVTaGFwZS5saW5lVG8oLS40LCAyMCkKICAgICAgICB0cmlhbmdsZVNoYXBlLmxpbmVUbyguNCwgMjApCiAgICAgICAgdHJpYW5nbGVTaGFwZS5saW5lVG8oMCwgMCk7CiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNoYXBlQnVmZmVyR2VvbWV0cnkodHJpYW5nbGVTaGFwZSk7CiAgICAgICAgdmFyIG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHsgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgY29sb3I6IHdDb2xvcihyYW5kcyg4KSkgfSkpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDA7IGkrKykgewogICAgICAgICAgICB0aGlzLm9iakxvbmcucHVzaChuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgY29sb3I6IHdDb2xvcihyYW5kcyg4KSkgfSkpKTsKICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnBvc2l0aW9uLnNldCgtMTAwICsgaSAqIDEwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnJvdGF0aW9uLnNldCgtLjUxLCAwLCAtLjUwKTsKICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnZ4ID0gMC4xOwogICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0udnkgPSAxLjk7CiAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS52eiA9IDA7CiAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS5yb3QgPSAwOwogICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmdyb3VwLmFkZCh0aGlzLm9iakxvbmdbaV0pOwogICAgICAgIH0KICAgICAgICB0aGlzLnNldEFuaW0oMjApOwogICAgICAgIHNjZW5lLmFkZCh0aGlzLmdyb3VwKTsKICAgICAgICB0aGlzLmdyb3VwLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLnRvYmogPSBbXTsKICAgICAgICB0aGlzLnRvYmpMb25nID0gW107CiAgICAgICAgdGhpcy5ncm91cDIgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHsKICAgICAgICAgICAgdGhpcy50b2JqLnB1c2godGhpcy5jcmVhdGVUT2JqKDMgKyByYW5kcyg4KSkpOwogICAgICAgICAgICB0aGlzLnRvYmpbaV0ucG9zaXRpb24uc2V0KC0xMDAgKyBpICogMTAsIDAsIDApOwogICAgICAgICAgICB0aGlzLnRvYmpbaV0udnggPSAwLjE7CiAgICAgICAgICAgIHRoaXMudG9ialtpXS52eSA9IDEuOTsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnZ6ID0gMDsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnJvdCA9IDA7CiAgICAgICAgICAgIHRoaXMudG9ialtpXS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgc2NlbmUuYWRkKHRoaXMuZ3JvdXAyKTsKICAgICAgICB0aGlzLnNldEZpbEFpbmF0aW9uKDAsIC0xMCwgMCk7CiAgICAgICAgdGhpcy5ncm91cDIudmlzaWJsZSA9IGZhbHNlOwogICAgICAgIHRoaXMuZ3JvdXAyLnRjb3VudCA9IDA7CiAgICAgICAgdGhpcy5ncm91cDIudHZ5ID0gMS4wMTsKICAgIH0KICAgIGNyZWF0ZU9iaihub2RlKSB7CiAgICAgICAgdmFyIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgY29sb3I6IHdDb2xvcihyYW5kcyg4KSkgfSk7CiAgICAgICAgdmFyIG9iamVjdCA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5DaXJjbGVCdWZmZXJHZW9tZXRyeSgyLCBub2RlLCAwLCBNYXRoLlBJICogMiksIG1hdGVyaWFsKTsKICAgICAgICB0aGlzLmdyb3VwLmFkZChvYmplY3QpOwogICAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9CiAgICBjcmVhdGVUT2JqKG5vZGUpIHsKICAgICAgICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCBjb2xvcjogd0NvbG9yKHJhbmRzKDgpKSB9KTsKICAgICAgICB2YXIgb2JqZWN0ID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkNpcmNsZUJ1ZmZlckdlb21ldHJ5KDIsIG5vZGUsIDAsIE1hdGguUEkgKiAyKSwgbWF0ZXJpYWwpOwogICAgICAgIHRoaXMuZ3JvdXAyLmFkZChvYmplY3QpOwogICAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9CiAgICB1cGRhdGUoKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9iai5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodGhpcy5vYmpbaV0udmlzaWJsZSkgewogICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0ucG9zaXRpb24ueCArPSB0aGlzLm9ialtpXS52eDsKICAgICAgICAgICAgICAgIHRoaXMub2JqW2ldLnBvc2l0aW9uLnkgKz0gdGhpcy5vYmpbaV0udnk7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5wb3NpdGlvbi56ICs9IHRoaXMub2JqW2ldLnZ6OwogICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0udnkgLT0gKC4wMyAqIENTUEQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMub2JqW2ldLnZ5IDwgLS42KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0ucG9zaXRpb24ueSA9IC0xMDAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2JqW2ldLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLm9ialtpXS52eSA8IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5zY2FsZS5zZXQodGhpcy5vYmpbaV0uc2NhbGUueCAtIC4wMywgdGhpcy5vYmpbaV0uc2NhbGUueCAtIC4wMywgdGhpcy5vYmpbaV0uc2NhbGUueCAtIC4wMyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0ucm90YXRpb24ueCArPSB0aGlzLm9ialtpXS5yb3Q7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5yb3RhdGlvbi55ICs9IHRoaXMub2JqW2ldLnJvdCAqIDI7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5yb3RhdGlvbi56ICs9IHRoaXMub2JqW2ldLnJvdCAqIDM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9iakxvbmcubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMub2JqTG9uZ1tpXS52aXNpYmxlKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0ucG9zaXRpb24ueCArPSB0aGlzLm9iakxvbmdbaV0udng7CiAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0ucG9zaXRpb24ueSArPSB0aGlzLm9iakxvbmdbaV0udnk7CiAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0ucG9zaXRpb24ueiArPSB0aGlzLm9iakxvbmdbaV0udno7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5yb3RhdGlvbi54ICs9IHRoaXMub2JqW2ldLnJvdDsKICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS52eSAtPSAoLjAzICogQ1NQRCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5vYmpMb25nW2ldLnZ5IDwgLS42KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnBvc2l0aW9uLnkgPSAtMTAwMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMub2JqTG9uZ1tpXS52eSA8IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0uc2NhbGUuc2V0KHRoaXMub2JqTG9uZ1tpXS5zY2FsZS54IC0gLjAzLCB0aGlzLm9iakxvbmdbaV0uc2NhbGUueCAtIC4wMywgdGhpcy5vYmpMb25nW2ldLnNjYWxlLnggLSAuMDMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudGVyICUgMTUgPT0gMCkgewogICAgICAgICAgICB0aGlzLnNldEFuaW0oMjApOwogICAgICAgIH0KCiAgICB9CiAgICBzZXRBbmltKG5vT2JqKSB7CiAgICAgICAgdmFyIGogPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5vYmoubGVuZ3RoICYmIGogPCBub09iajsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm9ialtpXS52aXNpYmxlID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS52eSA9ICgwLjggKyBNYXRoLnJhbmRvbSgpICogMS41KSAqIDEuMjsKICAgICAgICAgICAgICAgIHRoaXMub2JqW2ldLnZ6ID0gKC0xIC0gTWF0aC5yYW5kb20oKSAqIDMpICogLjI7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5yb3QgPSBNYXRoLnJhbmRvbSgpICogLjE7CiAgICAgICAgICAgICAgICBpZiAoaiA+IG5vT2JqICogLjUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS5wb3NpdGlvbi5zZXQoNjAgLSByYW5kcygxMCksIC0yMDAsIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0udnggPSAtKDAuMjIgKyBNYXRoLnJhbmRvbSgpICogLjE1KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0ucG9zaXRpb24uc2V0KC02MCArIHJhbmRzKDEwKSwgLTIwMCwgMTAwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS52eCA9ICgwLjIyICsgTWF0aC5yYW5kb20oKSAqIC4xNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICAgIHRoaXMub2JqW2ldLnNjYWxlLnNldCgxLCAxLCAxKTsKICAgICAgICAgICAgICAgIHRoaXMub2JqW2ldLnZ5ICo9IENTUEQ7CiAgICAgICAgICAgICAgICB0aGlzLm9ialtpXS52eiAqPSBDU1BEOwogICAgICAgICAgICAgICAgdGhpcy5vYmpbaV0udnggKj0gQ1NQRDsKICAgICAgICAgICAgICAgIHRoaXMub2JqW2ldLnJvdCAqPSBDU1BEOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHRoaXMub2JqTG9uZy5sZW5ndGggJiYgaiA8IDY7IGkrKykgewogICAgICAgICAgICBpZiAodGhpcy5vYmpMb25nW2ldLnZpc2libGUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS52eSA9ICgwLjggKyBNYXRoLnJhbmRvbSgpICogMS41KSAqIDEuMjsKICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS52eiA9ICgtMSAtIE1hdGgucmFuZG9tKCkgKiAzKSAqIC4yOwogICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnJvdCA9IE1hdGgucmFuZG9tKCkgKiAuMTsKICAgICAgICAgICAgICAgIGlmIChqICUgMiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnBvc2l0aW9uLnNldCg2MCAtIHJhbmRzKDEwKSwgLTIwMCwgMTAwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0udnggPSAtKDAuMiArIE1hdGgucmFuZG9tKCkgKiAuMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnJvdGF0aW9uLnNldCgtLjUxLCAwLCAwLjIwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnBvc2l0aW9uLnNldCgtNjAgKyByYW5kcygxMCksIC0yMDAsIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnZ4ID0gKDAuMiArIE1hdGgucmFuZG9tKCkgKiAuMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnJvdGF0aW9uLnNldCgtLjUxLCAwLCAtLjIwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS52eSAqPSBDU1BEOwogICAgICAgICAgICAgICAgdGhpcy5vYmpMb25nW2ldLnZ6ICo9IENTUEQ7CiAgICAgICAgICAgICAgICB0aGlzLm9iakxvbmdbaV0udnggKj0gQ1NQRDsKICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS5yb3QgKj0gQ1NQRDsKICAgICAgICAgICAgICAgIHRoaXMub2JqTG9uZ1tpXS5zY2FsZS5zZXQoMSwgMSwgMSk7CiAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgcmVzZXRBbGwodmlzaWJsZSkgewogICAgICAgIHRoaXMub2JqLmZvckVhY2goZWxlbWVudCA9PiB7IGVsZW1lbnQudmlzaWJsZSA9IGZhbHNlOyB9KTsKICAgICAgICB0aGlzLm9iakxvbmcuZm9yRWFjaChlbGVtZW50ID0+IHsgZWxlbWVudC52aXNpYmxlID0gZmFsc2U7IH0pOwogICAgICAgIHRoaXMuZ3JvdXAudmlzaWJsZSA9IHZpc2libGU7CiAgICB9CiAgICBzZXRGaWxBaW5hdGlvbih4LCB5LCB6KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRvYmoubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnBvc2l0aW9uLnNldCh4LCB5LCB6KTsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnZ4ID0gLTAuMSArIE1hdGgucmFuZG9tKCkgKiAuMjI7CiAgICAgICAgICAgIHRoaXMudG9ialtpXS52eSA9IC40ICsgTWF0aC5yYW5kb20oKSAqIC42NjsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnZ6ID0gLTAuMTEgKyBNYXRoLnJhbmRvbSgpICogLjIyOwogICAgICAgICAgICB0aGlzLnRvYmpbaV0ucm90ID0gMDsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnNjYWxlLnNldCgxLCAxLCAxKTsKICAgICAgICAgICAgdGhpcy50b2JqW2ldLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICB0aGlzLmdyb3VwMi52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB0aGlzLmdyb3VwMi50Y291bnQgPSAwOwogICAgICAgIHRoaXMuZ3JvdXAyLnR2eSA9IDEuMDE7CiAgICB9CiAgICB0VXBkYXRlKCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b2JqLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnRvYmpbaV0udnkgPiAtLjkxKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRvYmpbaV0ucG9zaXRpb24ueCArPSB0aGlzLnRvYmpbaV0udng7CiAgICAgICAgICAgICAgICB0aGlzLnRvYmpbaV0ucG9zaXRpb24ueSArPSB0aGlzLnRvYmpbaV0udnk7CiAgICAgICAgICAgICAgICB0aGlzLnRvYmpbaV0ucG9zaXRpb24ueiArPSB0aGlzLnRvYmpbaV0udno7CiAgICAgICAgICAgICAgICB0aGlzLnRvYmpbaV0udnkgLT0gLjAyOwogICAgICAgICAgICAgICAgaWYgKHRoaXMudG9ialtpXS5zY2FsZS54ID4gLjA2KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2JqW2ldLnNjYWxlLnNldCh0aGlzLnRvYmpbaV0uc2NhbGUueCAtIC4wMiwgdGhpcy50b2JqW2ldLnNjYWxlLnggLSAuMDIsIHRoaXMudG9ialtpXS5zY2FsZS54IC0gLjAyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXAyLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG1UdWJlW21QdXNoLnR1YmVOb10uZ3JvdXAucG9zaXRpb24ueSA9IG1UdWJlW21QdXNoLnR1YmVOb10uYXk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgp9Cg=="></script>
